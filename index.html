<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login</title>


    <link rel="stylesheet" type="text/css" href="./Controlador/assets/css/bootstrap.min.css" />
    <link href="./Controlador/assets/css/font-awesome.min.css" type="text/css" rel="stylesheet" />


</head>

<BODY>
    <div class="container" style="max-width: 400px;">





        <div class="row ">
            <div class="col ">
                <div class="" style="margin-top:50% !important">


                    <div class="text-center my-5">
                        <img src="./Controlador/assets/img/logo.png" style="height: 80px;" alt="logo">

                    </div>
                    <div class="well well-sm text-center"><i class="fa fa-lg fa-user-circle-o" aria-hidden="true"></i>

                    </div>
                    <div style="margin-top:5% !important">
                        <div class="alert alert-success  alert-dismissible hide">

                        </div>
                        <div class="alert alert-danger alert-dismissible hide">

                        </div>

                    </div>
                    <div class="panel panel-default">

                        <div class="panel-body">
                            <form id="loginForm" action="" method="POST">
                                <input type="text" name="id" id="id" value="" hidden>


                                <p id="message"></p>
                                <div id="correoFormGroup" class="form-group">

                                    <div class="input-group">
                                        <input type="text" class="form-control" id="correo" name="email"
                                            placeholder="usuario@correo.com">
                                        <span class="input-group-addon"><i class="fa fa-envelope"
                                                aria-hidden="true"></i></span>
                                    </div>

                                    <small class="correo_error_text text-danger"></small>
                                </div>

                                <div id="secretFormGroup" class="form-group">

                                    <div class="input-group">
                                        <input type="password" class="form-control " name="password" id="secret"
                                            placeholder="Contraseña">
                                        <span class="input-group-addon"><i class="fa fa-key"
                                                aria-hidden="true"></i></span>

                                    </div>


                                    <small class="secret_error_text text-danger"></small>
                                </div>
                                <div class="form-group ">
                                    <div class="text-right">
                                        <button type="submit" class="btn btn-primary">Entrar <i class="fa fa-sign-in"
                                                aria-hidden="true"></i></button>
                                    </div>
                                </div>
                            </form>

                        </div>

                    </div>

                </div>

            </div>

        </div>
    </div>


    <script src="./Controlador/assets/js/jquery-3.5.1.js" type="text/javascript"></script>
    <script src="./Controlador/assets/js/bootstrap.min.js" type="text/javascript"></script>

    <script>
        $(document).ready(function () {
            $(".alert-danger").hide();
            $(".alert-success").hide();

            $('#loginForm').submit(
                function (event) {
                    event.preventDefault();
                    check_correo();
                    check_secret();
                    var correo = $("#correo").val();
                    var secret = $("#secret").val();
                    if (correo.length == "" || secret.length == "") {
                        showDangerAlert("Por favor llene este campo primero");
                        return false;


                    } else {

                        $.ajax({
                            url: './Controlador/login_controller.php?method=login',
                            type: 'POST',
                            data: $("#loginForm").serialize(),

                            beforeSend: () => {
                                $("#loginForm .btn").html('<span class="">Cargando...</span>');
                            },

                            success: function (response) {
                                $("#loginForm .btn").html('<i class="fa fa-check"></i>');
                                console.log(response);
                                showSucessAlert(getJsonResponse(response).message);
                                setTimeout(function () {
                                    window.location.href = "./Vista/home.php";
                                }, 500);


                            },
                            error: error => {
                                console.log(error);
                                $("#loginForm .btn").html('Login');
                                showDangerAlert(getJsonResponse(error.responseText).message);

                            }
                        });

                    }

                }
            );


            $(".correo_error_text").hide();
            $(".secret_error_text").hide();
            var error_correo = false;
            var error_secret = false;
            $("#correo").keyup(function () {
                check_correo();
            });
            $("#secret").keyup(function () {
                check_secret();
            });

            function check_correo() {
                $("#message").hide();
                $("#correo").val($("#correo").val().trim());
                var pattern = new RegExp(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/);
                if (pattern.test($("#correo").val())) {
                    $(".correo_error_text").hide();
                    $("#correoFormGroup").addClass("has-success has-feedback");
                    $("#correoFormGroup").removeClass("has-error");

                } else {
                    $(".correo_error_text").html("Direccion de correo electronica invalida");
                    $(".correo_error_text").show();
                    $("#correoFormGroup").addClass("has-error");
                    error_correo = true;
                }

            }
            function check_secret() {
                $("#message").hide();
                $("#secret").val($("#secret").val().trim());
                var secret_length = $("#secret").val().length;
                if (secret_length < 4) {
                    $(".secret_error_text").html("La Contraseña debe tener almenos 4 caracteres");
                    $(".secret_error_text").show();
                    $("#secretFormGroup").addClass("has-error has-feedback");
                    error_secret = true;
                } else {
                    $("#secretFormGroup").removeClass("has-error");
                    $("#secretFormGroup").addClass("has-success");
                    $(".secret_error_text").hide();
                }
            }

            function showDangerAlert(message) {
                $(".alert-danger").removeClass("hide");
                $(".alert-danger").html(message).fadeIn();
            }

            function showSucessAlert(message) {
                $(".alert-success").removeClass("hide");
                $(".alert-success").html(message).fadeIn();
            }

            function getJsonResponse(data) {
                return JSON.parse(data);
            }


        });

    </script>
</BODY>

</HTML>